name: Release Please

on:
  workflow_call:
    inputs:
      config-file:
        description: 'Path to release-please config'
        required: false
        default: 'release-please-config.json'
        type: string
      manifest-file:
        description: 'Path to release-please manifest'
        required: false
        default: '.release-please-manifest.json'
        type: string
      cancel-in-progress:
        description: 'Cancel previous in-progress runs for same ref'
        required: false
        default: true
        type: boolean
    secrets:
      token:
        description: 'GitHub token'
        required: true
    outputs:
      release_created:
        description: 'Whether a release was created'
        value: ${{ jobs.release-please.outputs.release_created }}
      tag_name:
        description: 'Created release tag'
        value: ${{ jobs.release-please.outputs.tag_name }}

jobs:
  release-please:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    concurrency:
      group: ${{ format('{0}:{1}:{2}', github.workflow, github.repository, github.ref) }}
      cancel-in-progress: ${{ inputs.cancel-in-progress }}
    permissions:
      contents: write
      pull-requests: write
    outputs:
      release_created: ${{ steps.release.outputs.release_created }}
      tag_name: ${{ steps.release.outputs.tag_name }}
    steps:
      - id: release
        uses: googleapis/release-please-action@c3fc4de07084f75a2b61a5b933069bda6edf3d5c # v4
        with:
          config-file: ${{ inputs.config-file }}
          manifest-file: ${{ inputs.manifest-file }}
          token: ${{ secrets.token }}
